<link rel="import" href="lib-loader.html">
<link rel="import" href="annotation-helper-base.html">

<!--<script src="lib/DistanceHelper.js"></script>-->

<polymer-element name="distance-helper" attributes="selectedObject" extends="annotation-helper-base">
  <script>
    Polymer('distance-helper', {
      active:null,
      pointerPosition:null,
      helper:null,
      selectedObject:null,
      
      distance:null,
      ready:function(){
        this.helper = new DistanceHelper({arrowColor:0x000000,textBgColor:"#ffd200"});
      },
      onPicked:function(e){
        console.log("picked", this.localName);
        pickingDatas = e.detail.pickingInfos;
        if(pickingDatas.length == 0) return;
        
        var point = pickingDatas[0].point;//closest point
        var object = pickingDatas[0].object;
        
        //set point coordinates to be local , not global
        //FIXME: are we sure about this?
        //helper final instance will become attached to "object", do the same here
        //this.helper.position.setFromMatrixPosition( entryInteresect.object.matrixWorld );
        //object.worldToLocal( point );
      
        /*if(! this.helper.start){
          this.helper.unset();
          this.helper.startObject = object;
          this.helper.start = point;
          return;
        }else
        {
          this.helper.endObject = object;
          this.helper.end       = point;
          
          this.distance = this.helper.distance;
          
          console.log("blah");
          this.annotationDone({type:"distance", value:this.helper.distance,
            start:this.helper.start, end:this.helper.end, 
            startObject: this.helper.startObject, endObject: this.helper.endObject});
            
          this.helper.start = undefined;
          this.helper.end   = undefined;
        }*/
      
        /*if(! this.helper.start){
          this.helper.unset();
          this.helper.setStart( point, object );
          return;
        }else
        {
          this.helper.setEnd( point, object );
          this.distance = this.helper.distance;
          
          this.annotationDone({type:"distance", value:this.helper.distance,
            start:this.helper.start, end:this.helper.end, 
            startObject: this.helper.startObject, endObject: this.helper.endObject});
            
          this.helper.start = undefined;
        }*/
      }
     });
  </script>
</polymer-element>
